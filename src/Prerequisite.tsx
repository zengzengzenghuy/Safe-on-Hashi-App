import * as React from "react";
import { useState, useEffect } from "react";
import Button from "@mui/material/Button";
import { Dialog, Box, FormControl, MenuItem, Select } from "@mui/material";
import { ethers } from "ethers";
import HashiModuleABI from "./contract/abi/HashiModule.json";
import deployedContract from "./utils/contract.json";
import SafeAppsSDK, { SafeInfo } from "@gnosis.pm/safe-apps-sdk";
import SafeApiKit from "@safe-global/api-kit";
import Safe from "@safe-global/protocol-kit";
import { getTxServiceURL } from "./utils/helper";
import { EthersAdapter } from "@safe-global/protocol-kit";
import { InputLabel, TextField } from "@material-ui/core";

const SDK = new SafeAppsSDK();

export default function Prerequisite() {
  const [isHashiModuleOpen, setIsHashiModuleOpen] = useState<boolean>(false);
  const [safeInfo, setSafeInfo] = useState<SafeInfo | undefined>();
  const [chain, setChain] = useState<any>();

  const [sourceChain, setSourceChain] = useState<string>();
  const [sourceSafe, setSourceSafe] = useState<any>();
  useEffect(() => {
    async function loadSafeInfo() {
      const safuInfo = await SDK.safe.getInfo();
      const chainInfo = await SDK.safe.getChainInfo();
      setChain(chainInfo);
      console.log({ safuInfo, chainInfo });
      setSafeInfo(safuInfo);
    }

    loadSafeInfo();
  }, []);

  // const fetchData = async () => {
  //   try {
  // const response = await fetch("/src/contract/HashiModuleBytecode.bin");
  // const data = await response.arrayBuffer();
  // setBinaryData(data);
  // console.log(data);
  //     const byte = await fetch("/src/contract/HashiModuleBytecode.txt");
  //     console.log("Byte: ", byte);
  //     console.log("Type of byte", typeof byte);
  //   } catch (error) {
  //     console.error("Error fetching binary file:", error);
  //   }
  // };
  const handleDeployHashiModule = async () => {
    setIsHashiModuleOpen(true);
  };
  const deployHashiModule = async () => {
    try {
      let chainID: number;
      switch (sourceChain) {
        case "Ethereum":
          chainID = 1;
          break;
        case "Goerli":
          chainID = 5;
          break;
        default:
          chainID = 5;
          break;
      }
      if (chainID.toString() !== chain.chainId) {
        await window.ethereum.request({
          method: "wallet_switchEthereumChain",
          params: [{ chainId: "0x64" }], // Connect to Gnosis Chain
        });
      }
      const provider = new ethers.providers.Web3Provider(window.ethereum);
      // Prompt user for account connections
      await provider.send("eth_requestAccounts", []);
      const signer = provider.getSigner();
      const signerAddr = await signer.getAddress();

      const bytecode =
        "60806040523480156200001157600080fd5b506040516200324f3803806200324f83398181016040528101906200003791906200089a565b60008686868686866040516020016200005696959493929190620009c3565b604051602081830303815290604052905062000078816200008560201b60201c565b5050505050505062000de6565b60008060019054906101000a900460ff16159050808015620000b75750600160008054906101000a900460ff1660ff16105b80620000f35750620000d4306200049660201b620013321760201c565b158015620000f25750600160008054906101000a900460ff1660ff16145b5b62000135576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016200012c9062000ab7565b60405180910390fd5b60016000806101000a81548160ff021916908360ff160217905550801562000173576001600060016101000a81548160ff0219169083151502179055505b6000806000806000808780602001905181019062000192919062000b1e565b955095509550955095509550620001ae620004b960201b60201c565b600073ffffffffffffffffffffffffffffffffffffffff168573ffffffffffffffffffffffffffffffffffffffff16036200022257306040517f9f89457500000000000000000000000000000000000000000000000000000000815260040162000219919062000bba565b60405180910390fd5b600073ffffffffffffffffffffffffffffffffffffffff168473ffffffffffffffffffffffffffffffffffffffff16036200029657306040517f33300e7e0000000000000000000000000000000000000000000000000000000081526004016200028d919062000bba565b60405180910390fd5b84606660006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff16021790555083606760006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff16021790555082606860006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff16021790555081606960006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff16021790555080606a81905550620003b2866200051d60201b60201c565b8473ffffffffffffffffffffffffffffffffffffffff168673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff167f021b55b68ad6237c957aa06c685ee6048032c35a0c0e16082e2e8c9ce8fe6a408760405162000428919062000bba565b60405180910390a45050505050508015620004925760008060016101000a81548160ff0219169083151502179055507f7f26b83ff96e1f2b6a682f133852f6798a09c465da95921460cefb3847402498600160405162000489919062000c27565b60405180910390a15b5050565b6000808273ffffffffffffffffffffffffffffffffffffffff163b119050919050565b600060019054906101000a900460ff166200050b576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401620005029062000cba565b60405180910390fd5b6200051b620005b360201b60201c565b565b6200052d6200062760201b60201c565b600073ffffffffffffffffffffffffffffffffffffffff168173ffffffffffffffffffffffffffffffffffffffff16036200059f576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401620005969062000d52565b60405180910390fd5b620005b081620006b860201b60201c565b50565b600060019054906101000a900460ff1662000605576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401620005fc9062000cba565b60405180910390fd5b62000625620006196200077e60201b60201c565b620006b860201b60201c565b565b620006376200077e60201b60201c565b73ffffffffffffffffffffffffffffffffffffffff166200065d6200078660201b60201c565b73ffffffffffffffffffffffffffffffffffffffff1614620006b6576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401620006ad9062000dc4565b60405180910390fd5b565b6000603360009054906101000a900473ffffffffffffffffffffffffffffffffffffffff16905081603360006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff1602179055508173ffffffffffffffffffffffffffffffffffffffff168173ffffffffffffffffffffffffffffffffffffffff167f8be0079c531659141344cd1fd0a4f28419497f9722a3daafe3b4186f6b6457e060405160405180910390a35050565b600033905090565b6000603360009054906101000a900473ffffffffffffffffffffffffffffffffffffffff16905090565b600080fd5b600073ffffffffffffffffffffffffffffffffffffffff82169050919050565b6000620007e282620007b5565b9050919050565b620007f481620007d5565b81146200080057600080fd5b50565b6000815190506200081481620007e9565b92915050565b60006200082782620007d5565b9050919050565b62000839816200081a565b81146200084557600080fd5b50565b60008151905062000859816200082e565b92915050565b6000819050919050565b62000874816200085f565b81146200088057600080fd5b50565b600081519050620008948162000869565b92915050565b60008060008060008060c08789031215620008ba57620008b9620007b0565b5b6000620008ca89828a0162000803565b9650506020620008dd89828a0162000803565b9550506040620008f089828a0162000803565b94505060606200090389828a0162000848565b93505060806200091689828a0162000803565b92505060a06200092989828a0162000883565b9150509295509295509295565b6200094181620007d5565b82525050565b6000819050919050565b6000620009726200096c6200096684620007b5565b62000947565b620007b5565b9050919050565b6000620009868262000951565b9050919050565b60006200099a8262000979565b9050919050565b620009ac816200098d565b82525050565b620009bd816200085f565b82525050565b600060c082019050620009da600083018962000936565b620009e9602083018862000936565b620009f8604083018762000936565b62000a076060830186620009a1565b62000a16608083018562000936565b62000a2560a0830184620009b2565b979650505050505050565b600082825260208201905092915050565b7f496e697469616c697a61626c653a20636f6e747261637420697320616c72656160008201527f647920696e697469616c697a6564000000000000000000000000000000000000602082015250565b600062000a9f602e8362000a30565b915062000aac8262000a41565b604082019050919050565b6000602082019050818103600083015262000ad28162000a90565b9050919050565b600062000ae682620007b5565b9050919050565b62000af88162000ad9565b811462000b0457600080fd5b50565b60008151905062000b188162000aed565b92915050565b60008060008060008060c0878903121562000b3e5762000b3d620007b0565b5b600062000b4e89828a0162000b07565b965050602062000b6189828a0162000b07565b955050604062000b7489828a0162000b07565b945050606062000b8789828a0162000848565b935050608062000b9a89828a0162000b07565b92505060a062000bad89828a0162000883565b9150509295509295509295565b600060208201905062000bd1600083018462000936565b92915050565b6000819050919050565b600060ff82169050919050565b600062000c0f62000c0962000c038462000bd7565b62000947565b62000be1565b9050919050565b62000c218162000bee565b82525050565b600060208201905062000c3e600083018462000c16565b92915050565b7f496e697469616c697a61626c653a20636f6e7472616374206973206e6f74206960008201527f6e697469616c697a696e67000000000000000000000000000000000000000000602082015250565b600062000ca2602b8362000a30565b915062000caf8262000c44565b604082019050919050565b6000602082019050818103600083015262000cd58162000c93565b9050919050565b7f4f776e61626c653a206e6577206f776e657220697320746865207a65726f206160008201527f6464726573730000000000000000000000000000000000000000000000000000602082015250565b600062000d3a60268362000a30565b915062000d478262000cdc565b604082019050919050565b6000602082019050818103600083015262000d6d8162000d2b565b9050919050565b7f4f776e61626c653a2063616c6c6572206973206e6f7420746865206f776e6572600082015250565b600062000dac60208362000a30565b915062000db98262000d74565b602082019050919050565b6000602082019050818103600083015262000ddf8162000d9d565b9050919050565b6124598062000df66000396000f3fe608060405234801561001057600080fd5b50600436106101215760003560e01c806392eefe9b116100ad578063dfa3e78f11610071578063dfa3e78f146102aa578063e19a9dd9146102c6578063ef0e2ff4146102e2578063f2fde38b146102fe578063f77c47911461031a57610121565b806392eefe9b146102185780639a8a059214610234578063a4f9edbf14610252578063c91063891461026e578063d4b839921461028c57610121565b8063715018a6116100f4578063715018a614610198578063776d1a01146101a2578063789b11d7146101be5780637ceab3b1146101dc5780638da5cb5b146101fa57610121565b8063086cfca8146101265780634164139f14610142578063530b83711461015e5780635aef7de61461017a575b600080fd5b610140600480360381019061013b91906118c8565b610338565b005b61015c60048036038101906101579190611a96565b610406565b005b61017860048036038101906101739190611a96565b610809565b005b61018261085c565b60405161018f9190611b28565b60405180910390f35b6101a0610882565b005b6101bc60048036038101906101b791906118c8565b610896565b005b6101c6610964565b6040516101d39190611ba2565b60405180910390f35b6101e461098a565b6040516101f19190611b28565b60405180910390f35b6102026109b0565b60405161020f9190611b28565b60405180910390f35b610232600480360381019061022d91906118c8565b6109da565b005b61023c610af2565b6040516102499190611bcc565b60405180910390f35b61026c60048036038101906102679190611be7565b610af8565b005b610276610ed8565b6040516102839190611b28565b60405180910390f35b610294610f02565b6040516102a19190611b28565b60405180910390f35b6102c460048036038101906102bf91906118c8565b610f28565b005b6102e060048036038101906102db91906118c8565b611041565b005b6102fc60048036038101906102f79190611c30565b6111f6565b005b610318600480360381019061031391906118c8565b611289565b005b61032261130c565b60405161032f9190611b28565b60405180910390f35b610340611355565b6000606660009054906101000a900473ffffffffffffffffffffffffffffffffffffffff16905081606660006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff1602179055508173ffffffffffffffffffffffffffffffffffffffff168173ffffffffffffffffffffffffffffffffffffffff167f52ae88b092de36f87fb43fe794eb1381023b9c1bce563a871154022c63dce34260405160405180910390a35050565b606860009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff161461049a5730336040517f9b467d5e000000000000000000000000000000000000000000000000000000008152600401610491929190611c5d565b60405180910390fd5b606a54606860009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16639a8a05926040518163ffffffff1660e01b8152600401602060405180830381865afa15801561050a573d6000803e3d6000fd5b505050506040513d601f19601f8201168201806040525081019061052e9190611c9b565b146106025730606860009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16639a8a05926040518163ffffffff1660e01b8152600401602060405180830381865afa1580156105a1573d6000803e3d6000fd5b505050506040513d601f19601f820116820180604052508101906105c59190611c9b565b6040517f087e8b210000000000000000000000000000000000000000000000000000000081526004016105f9929190611cc8565b60405180910390fd5b606960009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16606860009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff166367e404ce6040518163ffffffff1660e01b8152600401602060405180830381865afa1580156106a8573d6000803e3d6000fd5b505050506040513d601f19601f820116820180604052508101906106cc9190611d06565b73ffffffffffffffffffffffffffffffffffffffff16146107b65730606860009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff166367e404ce6040518163ffffffff1660e01b8152600401602060405180830381865afa158015610755573d6000803e3d6000fd5b505050506040513d601f19601f820116820180604052508101906107799190611d06565b6040517f36dd1e5b0000000000000000000000000000000000000000000000000000000081526004016107ad929190611c5d565b60405180910390fd5b6107c2848484846113d3565b61080357306040517fbd86d9550000000000000000000000000000000000000000000000000000000081526004016107fa9190611b28565b60405180910390fd5b50505050565b610815848484846113d3565b61085657306040517fbd86d95500000000000000000000000000000000000000000000000000000000815260040161084d9190611b28565b60405180910390fd5b50505050565b606660009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1681565b61088a611355565b61089460006116ce565b565b61089e611355565b6000606760009054906101000a900473ffffffffffffffffffffffffffffffffffffffff16905081606760006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff1602179055508173ffffffffffffffffffffffffffffffffffffffff168173ffffffffffffffffffffffffffffffffffffffff167f90cc2f570a6eb594b1580ea3e41247d2d73a55281889e86bd4ec2fc29c7e62d660405160405180910390a35050565b606860009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1681565b606560009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1681565b6000603360009054906101000a900473ffffffffffffffffffffffffffffffffffffffff16905090565b6109e2611355565b606960009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168173ffffffffffffffffffffffffffffffffffffffff1603610a765730816040517f1f1b1f22000000000000000000000000000000000000000000000000000000008152600401610a6d929190611c5d565b60405180910390fd5b80606960006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff1602179055507e7582b62407f53d49cfc72e7ddab574c06ef3b8aced104b54b7bed4681ee54a3082604051610ae7929190611c5d565b60405180910390a150565b606a5481565b60008060019054906101000a900460ff16159050808015610b295750600160008054906101000a900460ff1660ff16105b80610b565750610b3830611332565b158015610b555750600160008054906101000a900460ff1660ff16145b5b610b95576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401610b8c90611db6565b60405180910390fd5b60016000806101000a81548160ff021916908360ff1602179055508015610bd2576001600060016101000a81548160ff0219169083151502179055505b60008060008060008087806020019051810190610bef9190611e52565b955095509550955095509550610c03611794565b600073ffffffffffffffffffffffffffffffffffffffff168573ffffffffffffffffffffffffffffffffffffffff1603610c7457306040517f9f894575000000000000000000000000000000000000000000000000000000008152600401610c6b9190611b28565b60405180910390fd5b600073ffffffffffffffffffffffffffffffffffffffff168473ffffffffffffffffffffffffffffffffffffffff1603610ce557306040517f33300e7e000000000000000000000000000000000000000000000000000000008152600401610cdc9190611b28565b60405180910390fd5b84606660006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff16021790555083606760006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff16021790555082606860006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff16021790555081606960006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff16021790555080606a81905550610df986611289565b8473ffffffffffffffffffffffffffffffffffffffff168673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff167f021b55b68ad6237c957aa06c685ee6048032c35a0c0e16082e2e8c9ce8fe6a4087604051610e6d9190611b28565b60405180910390a45050505050508015610ed45760008060016101000a81548160ff0219169083151502179055507f7f26b83ff96e1f2b6a682f133852f6798a09c465da95921460cefb38474024986001604051610ecb9190611f27565b60405180910390a15b5050565b6000606560009054906101000a900473ffffffffffffffffffffffffffffffffffffffff16905090565b606760009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1681565b610f30611355565b606860009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168173ffffffffffffffffffffffffffffffffffffffff1603610fc45730816040517ff62ea71c000000000000000000000000000000000000000000000000000000008152600401610fbb929190611c5d565b60405180910390fd5b80606860006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff1602179055507f396dc29b39823dd3fa244f342d3367b3e3c1715853a96eb7316d4062346a039f3082604051611036929190611c5d565b60405180910390a150565b611049611355565b600073ffffffffffffffffffffffffffffffffffffffff168173ffffffffffffffffffffffffffffffffffffffff1614611159578073ffffffffffffffffffffffffffffffffffffffff166301ffc9a77fe6d7a83a000000000000000000000000000000000000000000000000000000006040518263ffffffff1660e01b81526004016110d69190611f7d565b602060405180830381865afa1580156110f3573d6000803e3d6000fd5b505050506040513d601f19601f820116820180604052508101906111179190611fd0565b61115857806040517fb16ea67e00000000000000000000000000000000000000000000000000000000815260040161114f9190611b28565b60405180910390fd5b5b80606560006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff1602179055507f1151116914515bc0891ff9047a6cb32cf902546f83066499bcf8ba33d2353fa2606560009054906101000a900473ffffffffffffffffffffffffffffffffffffffff166040516111eb9190611b28565b60405180910390a150565b6111fe611355565b606a5481036112465730816040517fbedcf7ce00000000000000000000000000000000000000000000000000000000815260040161123d929190611cc8565b60405180910390fd5b80606a819055507f141f2b8816ee3b475f04f5f58fab5caa9abf1d82b55f31234f2594cb2ad4b124308260405161127e929190611cc8565b60405180910390a150565b611291611355565b600073ffffffffffffffffffffffffffffffffffffffff168173ffffffffffffffffffffffffffffffffffffffff1603611300576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016112f79061206f565b60405180910390fd5b611309816116ce565b50565b606960009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1681565b6000808273ffffffffffffffffffffffffffffffffffffffff163b119050919050565b61135d6117ed565b73ffffffffffffffffffffffffffffffffffffffff1661137b6109b0565b73ffffffffffffffffffffffffffffffffffffffff16146113d1576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016113c8906120db565b60405180910390fd5b565b600080606560009054906101000a900473ffffffffffffffffffffffffffffffffffffffff169050600073ffffffffffffffffffffffffffffffffffffffff168173ffffffffffffffffffffffffffffffffffffffff161461161e578073ffffffffffffffffffffffffffffffffffffffff166375f0bb528787878760008060008060006040518060400160405280600281526020017f3078000000000000000000000000000000000000000000000000000000000000815250336040518c63ffffffff1660e01b81526004016114b49b9a9998979695949392919061223b565b600060405180830381600087803b1580156114ce57600080fd5b505af11580156114e2573d6000803e3d6000fd5b50505050606760009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1663468721a7878787876040518563ffffffff1660e01b815260040161154794939291906122f4565b6020604051808303816000875af1158015611566573d6000803e3d6000fd5b505050506040513d601f19601f8201168201806040525081019061158a9190611fd0565b91508073ffffffffffffffffffffffffffffffffffffffff1663932713687f3078000000000000000000000000000000000000000000000000000000000000846040518363ffffffff1660e01b81526004016115e7929190612368565b600060405180830381600087803b15801561160157600080fd5b505af1158015611615573d6000803e3d6000fd5b505050506116c5565b606760009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1663468721a7878787876040518563ffffffff1660e01b815260040161167f94939291906122f4565b6020604051808303816000875af115801561169e573d6000803e3d6000fd5b505050506040513d601f19601f820116820180604052508101906116c29190611fd0565b91505b50949350505050565b6000603360009054906101000a900473ffffffffffffffffffffffffffffffffffffffff16905081603360006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff1602179055508173ffffffffffffffffffffffffffffffffffffffff168173ffffffffffffffffffffffffffffffffffffffff167f8be0079c531659141344cd1fd0a4f28419497f9722a3daafe3b4186f6b6457e060405160405180910390a35050565b600060019054906101000a900460ff166117e3576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016117da90612403565b60405180910390fd5b6117eb6117f5565b565b600033905090565b600060019054906101000a900460ff16611844576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161183b90612403565b60405180910390fd5b61185461184f6117ed565b6116ce565b565b6000604051905090565b600080fd5b600080fd5b600073ffffffffffffffffffffffffffffffffffffffff82169050919050565b60006118958261186a565b9050919050565b6118a58161188a565b81146118b057600080fd5b50565b6000813590506118c28161189c565b92915050565b6000602082840312156118de576118dd611860565b5b60006118ec848285016118b3565b91505092915050565b6000819050919050565b611908816118f5565b811461191357600080fd5b50565b600081359050611925816118ff565b92915050565b600080fd5b600080fd5b6000601f19601f8301169050919050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052604160045260246000fd5b61197e82611935565b810181811067ffffffffffffffff8211171561199d5761199c611946565b5b80604052505050565b60006119b0611856565b90506119bc8282611975565b919050565b600067ffffffffffffffff8211156119dc576119db611946565b5b6119e582611935565b9050602081019050919050565b82818337600083830152505050565b6000611a14611a0f846119c1565b6119a6565b905082815260208101848484011115611a3057611a2f611930565b5b611a3b8482856119f2565b509392505050565b600082601f830112611a5857611a5761192b565b5b8135611a68848260208601611a01565b91505092915050565b60028110611a7e57600080fd5b50565b600081359050611a9081611a71565b92915050565b60008060008060808587031215611ab057611aaf611860565b5b6000611abe878288016118b3565b9450506020611acf87828801611916565b935050604085013567ffffffffffffffff811115611af057611aef611865565b5b611afc87828801611a43565b9250506060611b0d87828801611a81565b91505092959194509250565b611b228161188a565b82525050565b6000602082019050611b3d6000830184611b19565b92915050565b6000819050919050565b6000611b68611b63611b5e8461186a565b611b43565b61186a565b9050919050565b6000611b7a82611b4d565b9050919050565b6000611b8c82611b6f565b9050919050565b611b9c81611b81565b82525050565b6000602082019050611bb76000830184611b93565b92915050565b611bc6816118f5565b82525050565b6000602082019050611be16000830184611bbd565b92915050565b600060208284031215611bfd57611bfc611860565b5b600082013567ffffffffffffffff811115611c1b57611c1a611865565b5b611c2784828501611a43565b91505092915050565b600060208284031215611c4657611c45611860565b5b6000611c5484828501611916565b91505092915050565b6000604082019050611c726000830185611b19565b611c7f6020830184611b19565b9392505050565b600081519050611c95816118ff565b92915050565b600060208284031215611cb157611cb0611860565b5b6000611cbf84828501611c86565b91505092915050565b6000604082019050611cdd6000830185611b19565b611cea6020830184611bbd565b9392505050565b600081519050611d008161189c565b92915050565b600060208284031215611d1c57611d1b611860565b5b6000611d2a84828501611cf1565b91505092915050565b600082825260208201905092915050565b7f496e697469616c697a61626c653a20636f6e747261637420697320616c72656160008201527f647920696e697469616c697a6564000000000000000000000000000000000000602082015250565b6000611da0602e83611d33565b9150611dab82611d44565b604082019050919050565b60006020820190508181036000830152611dcf81611d93565b9050919050565b6000611de18261186a565b9050919050565b611df181611dd6565b8114611dfc57600080fd5b50565b600081519050611e0e81611de8565b92915050565b6000611e1f8261188a565b9050919050565b611e2f81611e14565b8114611e3a57600080fd5b50565b600081519050611e4c81611e26565b92915050565b60008060008060008060c08789031215611e6f57611e6e611860565b5b6000611e7d89828a01611dff565b9650506020611e8e89828a01611dff565b9550506040611e9f89828a01611dff565b9450506060611eb089828a01611e3d565b9350506080611ec189828a01611dff565b92505060a0611ed289828a01611c86565b9150509295509295509295565b6000819050919050565b600060ff82169050919050565b6000611f11611f0c611f0784611edf565b611b43565b611ee9565b9050919050565b611f2181611ef6565b82525050565b6000602082019050611f3c6000830184611f18565b92915050565b60007fffffffff0000000000000000000000000000000000000000000000000000000082169050919050565b611f7781611f42565b82525050565b6000602082019050611f926000830184611f6e565b92915050565b60008115159050919050565b611fad81611f98565b8114611fb857600080fd5b50565b600081519050611fca81611fa4565b92915050565b600060208284031215611fe657611fe5611860565b5b6000611ff484828501611fbb565b91505092915050565b7f4f776e61626c653a206e6577206f776e657220697320746865207a65726f206160008201527f6464726573730000000000000000000000000000000000000000000000000000602082015250565b6000612059602683611d33565b915061206482611ffd565b604082019050919050565b600060208201905081810360008301526120888161204c565b9050919050565b7f4f776e61626c653a2063616c6c6572206973206e6f7420746865206f776e6572600082015250565b60006120c5602083611d33565b91506120d08261208f565b602082019050919050565b600060208201905081810360008301526120f4816120b8565b9050919050565b600081519050919050565b600082825260208201905092915050565b60005b8381101561213557808201518184015260208101905061211a565b60008484015250505050565b600061214c826120fb565b6121568185612106565b9350612166818560208601612117565b61216f81611935565b840191505092915050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052602160045260246000fd5b600281106121ba576121b961217a565b5b50565b60008190506121cb826121a9565b919050565b60006121db826121bd565b9050919050565b6121eb816121d0565b82525050565b6000819050919050565b600061221661221161220c846121f1565b611b43565b6118f5565b9050919050565b612226816121fb565b82525050565b61223581611dd6565b82525050565b600061016082019050612251600083018e611b19565b61225e602083018d611bbd565b8181036040830152612270818c612141565b905061227f606083018b6121e2565b61228c608083018a61221d565b61229960a083018961221d565b6122a660c083018861221d565b6122b360e0830187611b19565b6122c161010083018661222c565b8181036101208301526122d48185612141565b90506122e4610140830184611b19565b9c9b505050505050505050505050565b60006080820190506123096000830187611b19565b6123166020830186611bbd565b81810360408301526123288185612141565b905061233760608301846121e2565b95945050505050565b6000819050919050565b61235381612340565b82525050565b61236281611f98565b82525050565b600060408201905061237d600083018561234a565b61238a6020830184612359565b9392505050565b7f496e697469616c697a61626c653a20636f6e7472616374206973206e6f74206960008201527f6e697469616c697a696e67000000000000000000000000000000000000000000602082015250565b60006123ed602b83611d33565b91506123f882612391565b604082019050919050565b6000602082019050818103600083015261241c816123e0565b905091905056fea2646970667358221220347e0914159740ff2c9863facb4a1c02db0c0895524f7d450a6c1f058ca119bf64736f6c63430008120033";
      
        const hashiModuleFactory = new ethers.ContractFactory(
        HashiModuleABI,
        bytecode,
        signer
      );

      const hashiModule = await hashiModuleFactory.deploy(
        safeInfo?.safeAddress,
        safeInfo?.safeAddress,
        safeInfo?.safeAddress,
        deployedContract.Yaru,
        sourceSafe,
        chainID
      );
      console.log("Hashi Module address: ",hashiModule.address);

      const ethAdapter = new EthersAdapter({
        ethers,
        signerOrProvider: signer,
      });

      const TxServiceUrl: string = getTxServiceURL(`${chainID}`);
      const safeSdk = await Safe.create({
        ethAdapter,
        safeAddress: safeInfo?.safeAddress!,
      });
      const safeTx = await safeSdk.createEnableModuleTx(hashiModule.address);
      const txHash = await safeSdk.getTransactionHash(safeTx);
      const senderSignature = await safeSdk.signTransactionHash(txHash);

      const safeService = new SafeApiKit({
        txServiceUrl: TxServiceUrl,
        ethAdapter: ethAdapter,
      });
      await safeService.proposeTransaction({
        safeAddress: safeInfo?.safeAddress!,
        safeTransactionData: safeTx.data,
        safeTxHash: txHash,
        senderAddress: signerAddr,
        senderSignature: senderSignature.data,
      });
    } catch (err) {
      console.log(err);
    }
  };
  return (
    <React.Fragment>
      <h2>Prerequisite</h2>
      <h3>1. Deploy Safe on Destination Chain</h3>
      <p>Switch to Destination Chain and Create new account</p>
      <Button
        variant="outlined"
        href="https://app.safe.global/welcome"
        target="_blank"
      >
        Click to deploy
      </Button>
      <h3>2. Deploy Hashi Module for Safe on Destination Chain</h3>
      <p>Deploy and Enable Hashi Module for Safe on Destination Chain</p>
      <Button
        variant="outlined"
        onClick={() => {
          setIsHashiModuleOpen(true);
          handleDeployHashiModule();
        }}
      >
        Click to deploy
      </Button>
      <Dialog
        open={isHashiModuleOpen}
        onClose={() => {
          setIsHashiModuleOpen(false);
        }}
      >
        <Box sx={{ width: 400, height: 400, bgColor: "background.paper" }}>
          <Box sx={{ width: "90%", justifyContent: "center", marginLeft: 2 }}>
            <TextField
              margin="normal"
              variant="outlined"
              label="Source Chain Safe"
              value={sourceSafe}
              onChange={(event: React.ChangeEvent<HTMLInputElement>) => {
                setSourceSafe(event.target.value);
              }}
            ></TextField>
            <FormControl>
              <InputLabel>Source Chain</InputLabel>
              <Select
                variant="outlined"
                label="Source Chain"
                value={sourceChain}
                onChange={(event: any) => {
                  setSourceChain(event.target.value as string);
                }}
              >
                <MenuItem value="Ethereum">Ethereum</MenuItem>
                <MenuItem value="Goerli">Goerli</MenuItem>
              </Select>
            </FormControl>

            <Button variant="outlined" onClick={deployHashiModule}>
              Confirm Deploy
            </Button>
          </Box>
        </Box>
      </Dialog>
    </React.Fragment>
  );
}
